#!/bin/bash

IMG="img"
PARAMS=""
DISPLAY_RE="([0-9]+)x([0-9]+)\\+([0-9]+)\\+([0-9]+)"
IMAGE_RE="([0-9]+)x([0-9]+)"

scrot -z -o $IMG

LOCK="$HOME/.config/i3/lock.png"

LOCK_IMAGE_INFO=`identify $LOCK`
[[ $LOCK_IMAGE_INFO =~ $IMAGE_RE ]]

IMAGE_WIDTH=${BASH_REMATCH[1]}
IMAGE_HEIGHT=${BASH_REMATCH[2]}

# getting center coordinates of all outputs to place lock image
# from: https://github.com/guimeira/i3lock-fancy-multimonitor 

while read LINE
do

  if [[ $LINE =~ $DISPLAY_RE ]]; then

    WIDTH=${BASH_REMATCH[1]}
    HEIGHT=${BASH_REMATCH[2]}

    X=${BASH_REMATCH[3]}
    Y=${BASH_REMATCH[4]}

    POS_X=$(($X+$WIDTH/2-$IMAGE_WIDTH/2))
    POS_Y=$(($Y+$HEIGHT/2-$IMAGE_HEIGHT/2))

    PARAMS="$PARAMS '$LOCK' '-geometry' '+$POS_X+$POS_Y' '-composite'"
  fi

done <<<"`xrandr`"

PARAMS="'$IMG' '-scale' '10%' '-scale' '1000%' $PARAMS '$IMG'"
eval convert $PARAMS

i3lock -u -i $IMG