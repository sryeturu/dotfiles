#!/usr/bin/bash
# https://github.com/davatorium/rofi-scripts/blob/master/mode-scripts/rofi-file-browser.sh

echo -en "\0prompt\x1fsearch config:\n"

EDITOR=code

CUR_DIR=~/.config/
PREV_LOC_FILE=~/.config/rofi/rofi_prev_loc

if [ $# -eq 0 ] # launching confing menu for the first time with no args
then
    echo "$CUR_DIR" > "$PREV_LOC_FILE" # init "$PREV_LOC_FILE" to ~/.config
else
    CUR_DIR=$(cat "$PREV_LOC_FILE")

    if [ "$ROFI_RETV" -eq 10 ] # open editor in current directory
    then
        coproc (code "$CUR_DIR" > /dev/null 2>&1)
        exit 0
    elif [ "$1" = ".." ] # go back
    then
        CUR_DIR="$(dirname "$CUR_DIR")/"
        echo "$CUR_DIR" > "$PREV_LOC_FILE"
    else
        CUR_DIR+="$@"

        if [ -d "$CUR_DIR" ] # selected directory
        then 
            echo "$CUR_DIR" > "$PREV_LOC_FILE"
        else
            coproc ("$EDITOR" "$CUR_DIR" > /dev/null 2>&1)
            exit 0;
        fi
    fi

    if [ "$CUR_DIR" != ~/.config/ ]
    then
        echo ".."
    fi
fi

ls "$CUR_DIR" --group-directories-first --color=never --indicator-style=slash